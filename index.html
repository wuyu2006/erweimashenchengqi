<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>多功能二维码工具</title>
  <!-- 引入二维码生成库 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <!-- 引入 jsQR 库用于二维码解码 -->
  <script src="https://unpkg.com/jsqr/dist/jsQR.js"></script>
  <style>
    /* 全局样式 */
    body {
      background: linear-gradient(135deg, #f6d365, #fda085);
      font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      height: 100vh;
      justify-content: center;
      align-items: center;
    }
    /* 主容器 */
    .container {
      background: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      width: 90%;
      max-width: 500px;
    }
    /* 标签按钮 */
    .tabs {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-around;
      margin-bottom: 20px;
    }
    .tabs button {
      flex: 1 1 45%;
      padding: 10px 20px;
      background: #007BFF;
      color: #fff;
      border: none;
      border-radius: 5px;
      margin: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .tabs button.active,
    .tabs button:hover {
      background: #0056b3;
    }
    /* 标签内容区域 */
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .input-group {
      margin-bottom: 20px;
      text-align: center;
    }
    .input-group input[type="text"],
    .input-group input[type="file"] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 5px;
      box-sizing: border-box;
      margin-bottom: 10px;
    }
    button.generate-btn {
      padding: 10px 20px;
      font-size: 16px;
      color: #fff;
      background-color: #007BFF;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button.generate-btn:hover {
      background-color: #0056b3;
    }
    /* 二维码显示区域 */
    .qrcode-container {
      margin-top: 20px;
      display: flex;
      justify-content: center;
    }
    .result {
      margin-top: 20px;
      text-align: center;
      font-size: 16px;
      color: #333;
      word-break: break-all;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="tabs">
      <button class="tab-btn active" onclick="showTab('linkSection', this)">网页链接二维码</button>
      <button class="tab-btn" onclick="showTab('textSection', this)">文本二维码</button>
      <button class="tab-btn" onclick="showTab('randomSection', this)">随机二维码</button>
      <button class="tab-btn" onclick="showTab('decodeSection', this)">二维码解码</button>
    </div>
    
    <!-- 网页链接二维码界面 -->
    <div id="linkSection" class="tab-content active">
      <div class="input-group">
        <input type="text" id="urlInput" placeholder="请输入网页链接">
        <button class="generate-btn" onclick="generateQRCodeFromLink()">生成链接二维码</button>
      </div>
      <div id="qrcodeLink" class="qrcode-container"></div>
    </div>
    
    <!-- 文本二维码界面 -->
    <div id="textSection" class="tab-content">
      <div class="input-group">
        <input type="text" id="textInput" placeholder="请输入文本">
        <button class="generate-btn" onclick="generateQRCodeFromText()">生成文本二维码</button>
      </div>
      <div id="qrcodeText" class="qrcode-container"></div>
    </div>
    
    <!-- 随机二维码界面 -->
    <div id="randomSection" class="tab-content">
      <div class="input-group">
        <button class="generate-btn" onclick="generateRandomQRCode()">随机生成二维码</button>
      </div>
      <div id="qrcodeRandom" class="qrcode-container"></div>
    </div>
    
    <!-- 二维码解码界面 -->
    <div id="decodeSection" class="tab-content">
      <div class="input-group">
        <input type="file" id="fileInput" accept="image/*">
        <button class="generate-btn" onclick="decodeQRCode()">解码二维码</button>
      </div>
      <div id="decodeResult" class="result">解码结果将在此显示</div>
    </div>
  </div>

  <script>
    // 清空二维码容器内容
    function clearQRCode(containerId) {
      document.getElementById(containerId).innerHTML = "";
    }

    // 创建二维码（生成）
    function createQRCode(containerId, text) {
      clearQRCode(containerId);
      new QRCode(document.getElementById(containerId), {
        text: text,
        width: 200,
        height: 200,
        correctLevel: QRCode.CorrectLevel.H
      });
    }

    // 网页链接二维码生成
    function generateQRCodeFromLink() {
      const url = document.getElementById("urlInput").value;
      if (url.trim() === "") {
        alert("请输入有效的网页链接");
        return;
      }
      createQRCode("qrcodeLink", url);
    }

    // 文本二维码生成
    function generateQRCodeFromText() {
      const text = document.getElementById("textInput").value;
      if (text.trim() === "") {
        alert("请输入有效文本");
        return;
      }
      createQRCode("qrcodeText", text);
    }

    // 随机二维码生成
    function generateRandomQRCode() {
      const randomStr = Math.random().toString(36).substr(2, 8);
      createQRCode("qrcodeRandom", randomStr);
    }

    // 二维码解码（使用 jsQR）
    function decodeQRCode() {
      const fileInput = document.getElementById("fileInput");
      if (fileInput.files.length === 0) {
        alert("请选择二维码图片");
        return;
      }
      const file = fileInput.files[0];
      const reader = new FileReader();
      reader.onload = function(event) {
        const img = new Image();
        img.onload = function() {
          // 创建一个临时 canvas 用于绘制图片
          const canvas = document.createElement("canvas");
          const context = canvas.getContext("2d");
          canvas.width = img.width;
          canvas.height = img.height;
          context.drawImage(img, 0, 0, canvas.width, canvas.height);
          // 获取图像像素数据
          const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
          // 利用 jsQR 识别二维码
          const code = jsQR(imageData.data, imageData.width, imageData.height);
          if (code) {
            document.getElementById("decodeResult").innerText = "解码结果: " + code.data;
          } else {
            document.getElementById("decodeResult").innerText = "解码失败: 无法识别二维码";
          }
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(file);
    }

    // 标签页切换
    function showTab(tabId, btn) {
      const tabContents = document.getElementsByClassName("tab-content");
      for (let i = 0; i < tabContents.length; i++) {
        tabContents[i].classList.remove("active");
      }
      const tabButtons = document.getElementsByClassName("tab-btn");
      for (let i = 0; i < tabButtons.length; i++) {
        tabButtons[i].classList.remove("active");
      }
      document.getElementById(tabId).classList.add("active");
      btn.classList.add("active");
    }
  </script>
</body>
</html>
